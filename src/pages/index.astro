---
import Layout from '../layouts/Layout.astro'
import HeroCarousel from '../components/HeroCarousel'
import { getDB } from '../db'
import { estilosTable } from '../db/schema'
import { sql } from 'drizzle-orm'

const db = getDB(Astro.locals.runtime.env)

// Obtener todos los estilos agrupados por categoría para poder mezclarlos equitativamente
const allStyles = await db
  .select({
    id: estilosTable.id,
    nombre: estilosTable.nombre,
    imagen: estilosTable.imagen,
    estilo: estilosTable.estilo,
  })
  .from(estilosTable)

// Agrupar por categoría
const stylesByCategory: Record<number, any[]> = {}
allStyles.forEach(s => {
  if (!stylesByCategory[s.estilo]) stylesByCategory[s.estilo] = []
  stylesByCategory[s.estilo].push(s)
})

// Mezclar categorías y sacar uno de cada una de forma rotativa
const categories = Object.keys(stylesByCategory).map(Number).sort((a, b) => b - a)
const representativeStyles = []
let maxPerCategory = 2 // Intentamos sacar hasta 2 de cada categoría si hay suficientes
let addedCount = 0

for (let i = 0; i < maxPerCategory; i++) {
  categories.forEach(cat => {
    if (stylesByCategory[cat][i]) {
      representativeStyles.push(stylesByCategory[cat][i])
    }
  })
}

// Si tenemos pocos estilos, mezclamos el resultado final aleatoriamente
representativeStyles.sort(() => Math.random() - 0.5)
---

<Layout>
  <main
    class="min-h-screen flex flex-col items-center justify-center p-6 text-center relative overflow-hidden"
  >
    <HeroCarousel client:load styles={representativeStyles} />
    
    <div
      class="max-w-3xl space-y-8 animate-in fade-in slide-in-from-bottom-8 duration-1000 z-30"
    >
      <div
        class="inline-block px-4 py-1.5 mb-4 text-sm font-semibold tracking-wider text-orange-500 uppercase bg-orange-500/10 rounded-full border border-orange-500/20"
      >
        Edición Limitada 2026
      </div>

      <h1
        class="text-6xl md:text-8xl font-bold tracking-tight bg-linear-to-b from-white to-gray-400 bg-clip-text text-transparent"
      >
        Vístete con <span class="text-orange-500">Stryd</span>
      </h1>

      <p
        class="text-lg md:text-xl text-gray-400 max-w-xl mx-auto leading-relaxed"
      >
        Rendimiento premium. Estilo inigualable. Haz tu pedido hoy y forma parte
        de la comunidad de atletas más exclusiva.
      </p>

      <div class="pt-8">
        <a
          href="/nuevo-pedido"
          class="group relative inline-flex items-center justify-center px-8 py-4 font-bold text-white transition-all duration-200 bg-orange-600 rounded-xl hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-600"
        >
          Hacer mi Pedido
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-5 h-5 ml-2 transition-transform group-hover:translate-x-1"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
          </svg>
        </a>
      </div>

      <div class="pt-16 grid grid-cols-1 md:grid-cols-3 gap-8 text-left">
        <div
          class="p-6 rounded-2xl bg-white/5 border border-white/10 backdrop-blur-sm"
        >
          <div class="text-orange-500 mb-3">
            <svg
              class="w-8 h-8"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"></path></svg
            >
          </div>
          <h3 class="text-xl font-bold mb-2">Calidad Pro</h3>
          <p class="text-gray-400 text-sm">
            Telas de alto rendimiento diseñadas para el máximo confort.
          </p>
        </div>
        <div
          class="p-6 rounded-2xl bg-white/5 border border-white/10 backdrop-blur-sm"
        >
          <div class="text-orange-500 mb-3">
            <svg
              class="w-8 h-8"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              ><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path></svg
            >
          </div>
          <h3 class="text-xl font-bold mb-2">Envío Rápido</h3>
          <p class="text-gray-400 text-sm">
            Recibe tu pedido en tiempo récord directo a tu puerta.
          </p>
        </div>
        <div
          class="p-6 rounded-2xl bg-white/5 border border-white/10 backdrop-blur-sm"
        >
          <div class="text-orange-500 mb-3">
            <svg
              class="w-8 h-8"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              ><path
                d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
              ></path></svg
            >
          </div>
          <h3 class="text-xl font-bold mb-2">Compra Segura</h3>
          <p class="text-gray-400 text-sm">
            Garantía de satisfacción total en cada una de tus compras.
          </p>
        </div>
      </div>
    </div>
  </main>
</Layout>
